/**
 * ====================================
 * EchoBot.js - 따라말하기 봇 (초보자용 상세 주석 버전)
 * ====================================
 * 
 * 이 봇은 "따라해"로 시작하는 메시지를 받으면, 
 * "따라해" 다음에 오는 내용을 그대로 따라서 답장하는 봇입니다.
 * 
 * 예시: 
 *   사용자: "따라해 안녕하세요"
 *   봇: "안녕하세요"
 */

// ====== 1단계: 봇 객체 가져오기 ======
// BotManager는 메신저봇에서 제공하는 관리자입니다.
// getCurrentBot()을 통해 현재 실행중인 봇(EchoBot)의 제어권을 가져옵니다.
// 이 bot 변수를 통해 봇의 모든 기능을 사용할 수 있습니다.
var bot = BotManager.getCurrentBot();

// ====== 2단계: 메시지 이벤트 설정 ======
// bot.on("message", function(msg) {...})의 의미:
// - bot.on: "봇아, 이벤트가 발생하면 반응해라"
// - "message": "그 이벤트는 '메시지를 받았을 때'야"
// - function(msg): "메시지를 받으면 이 함수를 실행해라"
// - msg: 받은 메시지의 모든 정보가 담긴 객체 (보낸 사람, 내용, 방 이름 등)
bot.on("message", function(msg) {
    
    // ====== 3단계: 메시지 내용 확인 ======
    // msg.content: 사용자가 보낸 실제 메시지 텍스트
    // 예: "따라해 안녕하세요" 라고 보냈다면 msg.content는 "따라해 안녕하세요"
    
    // indexOf("따라해")의 의미:
    // - 문자열에서 "따라해"라는 단어가 시작되는 위치를 찾습니다
    // - 맨 앞에 있으면 0을 반환 (컴퓨터는 0부터 세기 시작)
    // - 없으면 -1을 반환
    // 
    // == 0의 의미:
    // - "따라해"가 문장의 맨 앞(0번 위치)에 있는지 확인
    // - 즉, "따라해"로 시작하는 메시지인지 확인
    // 
    // ⚠️ 주의사항:
    // - 현재 코드는 "따라해안녕"처럼 띄어쓰기 없이 붙어도 실행됩니다
    // - "따라해 "로 체크하면 띄어쓰기를 강제할 수 있습니다 (아래 실습 과제 참고)
    if (msg.content.indexOf("따라해") == 0) {
        
        // ====== 4단계: "따라해" 다음 내용 추출 ======
        // substring(4)의 의미:
        // - 인덱스 4번 위치부터 끝까지 잘라내기
        // 
        // 문자열 인덱스 설명:
        // "따라해 안녕하세요"의 각 문자 위치
        // 인덱스: 0  1  2  3  4  5  6  7  8
        // 문  자: 따 라 해 공백 안 녕 하 세 요
        // 
        // substring(4)는 인덱스 4부터 시작하므로 "안녕하세요"가 됩니다
        // 
        // ⚠️ 현재 문제점:
        // - "따라해 안녕"은 정상 동작 → "안녕"
        // - "따라해안녕"도 동작하지만 → "안녕"이 아닌 빈 문자열이 됨
        var text = msg.content.substring(4);
        
        // ====== 5단계: 답장 보내기 ======
        // msg.reply(): 같은 채팅방에 답장을 보내는 함수
        // text: 위에서 추출한 "따라해" 다음의 내용
        // 
        // 이 함수가 실행되면:
        // - 메시지를 보낸 채팅방에
        // - text 내용으로 답장을 보냅니다
        // - (참고: 보낸 사람을 태그하지는 않습니다)
        msg.reply(text);
    }
    
    // if 문이 false인 경우 (메시지가 "따라해"로 시작하지 않는 경우):
    // - 아무것도 하지 않고 무시합니다
    // - 다음 메시지를 기다립니다
});

/**
 * ====== 메신저봇 동작 원리 정리 ======
 * 
 * 1. 봇이 켜져있는 동안 카톡 메시지를 계속 감시합니다
 * 2. 누군가 메시지를 보내면 bot.on("message", ...) 함수가 자동 실행됩니다
 * 3. 받은 메시지가 "따라해"로 시작하는지 확인합니다
 * 4. "따라해"로 시작한다면, 그 뒤의 내용만 추출합니다
 * 5. 추출한 내용을 그대로 답장으로 보냅니다
 * 
 * ====== 주요 변수/함수 설명 ======
 * 
 * - var: 변수를 선언하는 키워드 (값을 저장하는 상자를 만듦)
 * - bot: 우리가 만든 봇을 제어하는 리모컨
 * - msg: 받은 메시지의 모든 정보를 담은 상자
 * - msg.content: 메시지 내용 (텍스트)
 * - msg.reply(): 답장 보내기 기능
 * - indexOf(): 특정 문자열의 위치 찾기
 * - substring(): 문자열 자르기
 * 
 * ====== 실습 과제 ======
 * 
 * [초급]
 * 1. "따라해" 대신 다른 명령어로 바꿔보세요 (예: "반복해")
 * 2. 답장할 때 "봇: " 을 앞에 붙여보세요
 *    예) msg.reply("봇: " + text);
 * 
 * [중급]
 * 3. 띄어쓰기를 강제하려면 어떻게 해야 할까요?
 *    힌트: indexOf("따라해 ") 처럼 공백을 포함시키고, substring(4)도 조정
 * 4. text가 비어있으면 "따라할 내용을 입력해주세요"라고 답장하기
 *    힌트: if (text.length == 0) { ... }
 * 
 * [고급]
 * 5. trim() 함수를 사용해서 앞뒤 공백 제거하기
 *    var text = msg.content.substring(4).trim();
 * 6. "따라해"가 없을 때 도움말 표시하기
 *    else { msg.reply("사용법: 따라해 [메시지]"); }
 * 
 * ====== 개선된 코드 예시 (고급) ======
 * 
 * var trigger = "따라해 ";  // 공백 포함한 명령어
 * if (msg.content.indexOf(trigger) == 0) {
 *     var text = msg.content.substring(trigger.length).trim();
 *     if (text.length > 0) {
 *         msg.reply(text);
 *     } else {
 *         msg.reply("따라할 내용을 입력해주세요!");
 *     }
 * }
 */